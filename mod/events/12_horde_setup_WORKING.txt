namespace = grimstart

country_event = {
	id = grimstart.9
	hide_window = yes
	is_triggered_only = yes
	trigger = { merg_is_default_empire = yes }

	immediate = {
		# if = { limit = { NOT = { has_origin = origin_default } } sometimes the presets can lose they origin
		get_capital_planet = yes # TODO Maybe too early
		give_tech_no_error_effect = { TECH = tech_planetary_defenses MESSAGE = no }		# Tier 0
		give_tech_no_error_effect = { TECH = tech_assault_armies MESSAGE = no }			# Tier 0
		if = {
			limit = { NOR = { is_ai = yes has_global_flag = allthatisgrimdark_mod } }
			set_global_flag = allthatisgrimdark_mod
		}
		random_owned_species = {
			limit = {
				is_sapient = yes
				NOT = { is_same_species = prev }
			}
			save_event_target_as = servile_species
			event_target:capital_planet = {
				create_pop_group = { species = event_target:servile_species }
			}
		}
		if = { # 1 Setup Barbaric Horde "Ork Horde"
			limit = {
				OR = {
					has_origin = origin_barbarichorde
					has_country_flag = ork_empire
					owner_main_species = {
						OR = {
							AND = { # Compat Mod "WH species"
								has_global_flag = WHspecies_installed
								OR = { species_portrait = "Orkz" is_species_class = "Orkz" }
							}
							# is_species_class = "Ork"	# Compat Mod "Orks species" TODO
							has_trait = "trait_orkz"
							is_species = name_list_ORK1
						}
					}
				}
			}
			give_technology = { message = no tech = tech_artificial_moral_codes }		# tier = 2
			give_tech_option_or_progress_effect = { TECH = tech_penal_colonies }		# tier = 3
			if = {
			   limit = { exists = event_target:capital_planet }
				event_target:capital_planet = {
					add_deposit = d_ore_rich_caverns
					add_deposit = d_ore_rich_caverns
					add_deposit = d_lichen_fields
					add_deposit = d_fungal_caves
					add_deposit = d_fungal_caves
					add_deposit = d_fungal_caves
					add_deposit = d_searing_desert
					remove_district = district_city
					add_district = district_industrial
					remove_building = building_foundry_1
					remove_building = building_temple
					remove_building = building_factory_1
					remove_building = building_commercial_zone
					remove_building = building_bureaucratic_1
					remove_building = building_research_lab_1
					add_building = building_mekworkshop
					add_building = building_squigburna
				}
			}
			random_owned_species = {
				limit = {
					is_crossbreeding_possible = yes
					NOT = { is_same_species = root }
				}
				root = {
					modify_species = {
						species = prev
						effect = {
							if = {
								limit = { NOT = { has_trait = trait_syncretic_proles } }
								change_species_characteristics = { add_trait = trait_syncretic_proles }
							}
							if = {
								limit = { NOT = { has_trait = trait_survivor } }
								change_species_characteristics = { add_trait = trait_survivor }
							}
							if = {
								limit = { NOT = { has_trait = trait_orkz } }
								change_species_characteristics = { add_trait = trait_orkz can_change_leader = yes }
							}
							if = { # Compare with prescipted empire design
								limit = {
									NOT = { has_trait = trait_incubator }
									OR = { root = { is_ai = yes } has_toxoids = yes }
								}
								change_species_characteristics = { add_trait = trait_incubator }
							}
							save_event_target_as = servile_species
							set_species_flag = syncretic_species@root
						}
					}
				}
			}
			owner_main_species = {
				set_variable = { which = loop_count value = 3 }
                while = {
                    limit = { check_variable = { which = loop_count value > 0 } }
                    random_species_pop = { kill_pop_group = yes }
                    change_variable = { which = loop_count }
                }
				if = {
					limit = { NOT = { has_trait = trait_pc_nuked_preference } }
					change_species_characteristics = { add_trait = trait_pc_nuked_preference }
				}
				if = {
					limit = { NOT = { has_trait = trait_survivor } }
					change_species_characteristics = { add_trait = trait_survivor }
				}
				if = {
					limit = { NOT = { has_trait = trait_orkz } }
					change_species_characteristics = { add_trait = trait_orkz can_change_leader = yes }
				}
				# TODO TEST
				random_galaxy_species = {
					limit = {
						is_sapient = yes
						is_same_species_class = prev
						NOT = { is_same_species = prev }
						OR = {
							AND = { # Compat Mod "WH species"
								has_global_flag = WHspecies_installed
								OR = { species_portrait = "Orkz" is_species_class = "Orkz" }
							}
							has_trait = "trait_orkz"
							# AND = { is_species_class = "HUM" species_portrait = "humanoid_hp_12" }
							# species_portrait = prev # TODO scope allowed?
							is_species = name_list_ORK1
						}
					}
					prev = { set_species_identity = prev }

				}
				if = { # Try to prevent purge somehow for fanatic xenophobe
					limit = { exists = event_target:servile_species root = { is_xenophobe = yes } }
					event_target:servile_species = { set_species_identity = prev }
				}
			}

			if = { # Compat
				limit = { NOT = { has_origin = origin_barbarichorde } }
				set_origin = origin_barbarichorde
			}
			every_owned_leader = {
				limit = { NOR = { leader_class = scientist species = { has_trait = trait_very_strong } } }
				modify_species = { add_trait = trait_very_strong }
			}
			set_country_flag = ork_empire
			country_event = { id = aagrimstarts.2001 days = 10 } # relations
		}
	}
}