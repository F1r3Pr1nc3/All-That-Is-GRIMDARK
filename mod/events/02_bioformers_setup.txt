
namespace = grimstart

country_event = {
	id = grimstart.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_origin = origin_bioreformers
	}

	immediate = {
		owner_main_species = {
			if = {
				limit = {
					NOT = { has_trait = trait_tyranid }
				}
				change_species_characteristics = {
					add_trait = trait_tyranid
					add_traits_at_start_of_list = yes
					can_change_leader = yes
				}
			}
			if = {
				limit = {
					OR = {
						prev = { is_ai = yes }
						has_necroids = yes
					}
					NOR = {
						has_trait = trait_necrophage
						prev = {
							OR = {
								is_xenophile = yes
								has_ethic = ethic_fanatic_egalitarian
								is_death_cult_empire = yes
								has_civic = civic_hive_empath
								has_civic = civic_permanent_employment
							}
						}
					}
				}
				change_species_characteristics = {
					add_trait = trait_necrophage
					add_traits_at_start_of_list = yes
					can_change_leader = yes
				}
			}
		}
		give_technology = { message = no tech = tech_space_exploration }
		give_technology = { message = no tech = tech_colonization_1 }
		give_technology = { message = no tech = tech_terrestrial_sculpting }
		give_technology = { tech = tech_genome_mapping message = yes }	# Tier 1
		give_technology = { message = no tech = tech_cloning }
		give_technology = { message = no tech = tech_gene_tailoring }	# Tier 3
		give_technology = { message = no tech = tech_morphogenetic_field_mastery }
		give_technology = { message = no tech = tech_climate_restoration }
		get_capital_planet = yes
		event_target:capital_planet = {
			clear_blockers = yes
			# clear_basic_districts?
			if = {
				limit = { planet_size < 25 }
				set_planet_size = 25
			}
			validate_planet_buildings_and_districts = yes
			## Add the districts and buildings
			remove_building = building_hive_warren
			while = {
				count = 3
				add_district = district_hive
			}
			add_zone = { district = district_hive zone = zone_default }
			add_zone = { district = district_hive zone = zone_urban }
			while = {
				count = 4
				add_district = district_farming_uncapped
			}
			add_zone = { district = district_farming_uncapped zone = zone_urban_food }
			while = {
				count = 1
				add_district = district_mining_uncapped
			}
			add_zone = { district = district_mining_uncapped zone = zone_minerals }
			while = {
				count = 3
				add_district = district_generator_uncapped
			}
			add_zone = { district = district_generator_uncapped zone = zone_energy }
		}
		create_fleet = {
			set_take_point = yes
			effect = {
				set_owner = prev
				while = {
					count = 2
					create_ship = { name = random random_existing_design = corvette }
				}
				set_location = prev.capital_star
			}
		}
		# Buff them
		add_resource = {
			energy = 1000
			minerals = 5000
			alloys = 500
		}
		add_resource = {
			energy = 1000
			minerals = 5000
			alloys = 500
		}
		if = {
			limit = { is_machine_empire = no }
			add_resource = { food = 1000 }
		}
		if = {
			limit = { is_gestalt = no }
			add_resource = { consumer_goods = 1000 }
		}
		set_country_flag = tyranid_empire
		country_event = { id = aagrimstarts.2001 days = 10 } # Updated Relations event
		if = {
			limit = {
				has_grand_archive_dlc = yes
				NOR = {
					is_gestalt = yes
					has_civic = civic_beastmasters
					has_civic = civic_eager_explorers
					has_civic = civic_corporate_beastmasters
				}
			}
			if = {
				limit = { is_megacorp = no }
				force_add_civic = civic_beastmasters
			}
			else_if = {
				limit = {
					OR = {
						is_megacorp = yes
						has_civic = civic_galactic_sovereign_megacorp
					}
					NOT = { has_civic = civic_privatized_exploration }
				}
				force_add_civic = civic_corporate_beastmasters
			}
		}
		# Support Warhammer 40K - Tyranids
		if = {
			limit = { is_ai = yes }
			set_graphical_culture = tyranid_01
			set_city_graphical_culture = tyranid_01
		}
		if = { # Compat
			limit = {
				NOR = {
					has_country_flag = humanoid
					owner_main_species = {
						OR = {
							is_species_class = "Genestealer"	# Compat Mod "WH species"
							species_portrait = "Genestealer"	# Compat Mod "WH species"
							is_species = "Genestealer"
						}
					}
				}
			}
			if = {
				limit = {
					NOT = { has_origin = origin_bioreformers }
				}
				if = { # Compat Mod "Warhammer 40K - Tyranids"
					limit = {
						has_origin = origin_tyranid_planet
						owner_main_species = {
							NOT = { is_species_class = "Tyranid" }
						}
					}
					owner_main_species = {
						mirror_species = { class = "Tyranid" }
					}
				}
				set_origin = origin_bioreformers
			}
			set_policy = {
				policy = first_contact_protocol
				option = first_contact_attack_allowed
				cooldown = yes
			}
		}
		else_if = { # Compat Genestealer
			limit = {
				NOT = { has_origin = origin_bioreformers }
			}
			if = {
				limit = { has_ethic = ethic_authoritarian }
				country_remove_ethic = ethic_authoritarian
			}
			if = {
				limit = { is_pacifist = no }
				shift_ethic = ethic_pacifist
			}
			if = {
				limit = { is_xenophile = no }
				shift_ethic = ethic_xenophile
			}
			set_ai_personality = migrating_flock
			if = {
				limit = {
					NOT = { has_civic = civic_selective_kinship }
				}
				force_add_civic = civic_selective_kinship
			}
			if = {
				limit = {
					host_has_dlc = "Apocalypse"
					NOT = { has_civic = civic_barbaric_despoilers }
				}
				# force_add_civic = civic_barbaric_despoilers
				change_government = {
					civics = { civic = civic_barbaric_despoilers }
					remove_invalid_civics = yes
				}
			}
			if = {
				limit = { is_megacorp = no }
				change_government = {
					authority = auth_corporate
					civics = {
						civic = civic_selective_kinship
						civic = civic_criminal_heritage
					}
					remove_invalid_civics = yes
				}
			}
			if = {
				limit = {
					NAND = {
						is_megacorp = yes
						has_civic = civic_galactic_sovereign_megacorp
					}
				}
				force_add_civic = civic_galactic_sovereign_megacorp
			}
			if = {
				limit = {
					NOT = { has_civic = civic_criminal_heritage }
				}
				force_add_civic = civic_criminal_heritage
			}
			if = {
				limit = { is_ai = yes }
				set_ai_personality = migrating_flock
			}
			set_policy = {
				policy = first_contact_protocol
				option = first_contact_proactive
				cooldown = yes
			}
			set_country_flag = human_empire
		}
		if = {
			limit = {
				is_ai = yes
				has_origin = origin_bioreformers
			}
			give_technology = { message = no tech = tech_fusion_power }				# tier = 1
			give_technology = { message = no tech = tech_missiles_2 }				# tier = 1
			give_technology = { message = no tech = tech_space_whale_weapon_1 }		        # tier = 1
			add_research_option = tech_amoeba_strike_craft_1					# tier = 2
			add_research_option = tech_swarmer_missiles_1						# tier = 2
		}
	}
}
